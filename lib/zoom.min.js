!function(t){"use strict";function o(t,e){return t[0]!=e[0]&&(!!t.attr("page")||!!t.parent()[0]&&o(t.parent(),e))}function e(t){function o(t){this.name="TurnJsError",this.message=t}return o.prototype=new Error,o.prototype.constructor=o,new o(t)}function i(t,o,e){return a&&e?" translate3d("+t+"px,"+o+"px, 0px) ":" translate("+t+"px, "+o+"px) "}function n(t,o){return a&&o?" scale3d("+t+", "+t+", 1) ":" scale("+t+") "}function s(t,o){return{x:t,y:o}}function r(t,o){return function(){return t.apply(o,arguments)}}var a,u={max:2,flipbook:null,easeFunction:"ease-in-out",duration:500,when:{}},h={init:function(o){var i=this,n=this.data(),l=t.extend({},u,o);if(!l.flipbook||!l.flipbook.turn("is"))throw e("options.flipbook is required");if(a="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style,"function"!=typeof l.max){var p=l.max;l.max=function(){return p}}n.zoom={opts:l,axis:s(0,0),scrollPos:s(0,0),eventQueue:[],mouseupEvent:function(){return h._eMouseUp.apply(i,arguments)},eventTouchStart:r(h._eTouchStart,i),eventTouchMove:r(h._eTouchMove,i),eventTouchEnd:r(h._eTouchEnd,i),flipbookEvents:{zooming:r(h._eZoom,i),pressed:r(h._ePressed,i),released:r(h._eReleased,i),start:r(h._eStart,i),turning:r(h._eTurning,i),turned:r(h._eTurned,i),destroying:r(h._eDestroying,i)}};for(var d in l.when)Object.prototype.hasOwnProperty.call(l.when,d)&&this.bind("zoom."+d,l.when[d]);for(d in n.zoom.flipbookEvents)Object.prototype.hasOwnProperty.call(n.zoom.flipbookEvents,d)&&l.flipbook.bind(d,n.zoom.flipbookEvents[d]);this.css({position:"relative",overflow:"hidden"}),t.isTouch?(l.flipbook.bind("touchstart",n.zoom.eventTouchStart).bind("touchmove",n.zoom.eventTouchMove).bind("touchend",n.zoom.eventTouchEnd),this.bind("touchstart",h._tap)):this.mousedown(h._mousedown).click(h._tap)},_tap:function(e){var i=t(this),n=i.data().zoom;n.opts.flipbook;if(!n.draggingCorner&&!n.dragging&&o(t(e.target),i)){h._addEvent.call(i,"tap",e);var s=h._eventSeq.call(i);s&&i.trigger(s)}},_addEvent:function(t,o){var e=this.data().zoom,i=(new Date).getTime(),n={name:t,timestamp:i,event:o};e.eventQueue.push(n),e.eventQueue.length>10&&e.eventQueue.splice(0,1)},_eventSeq:function(){var o=this.data().zoom,e=o.eventQueue,i=e.length-1;return i>0&&"tap"==e[i].name&&"tap"==e[i-1].name&&e[i].event.pageX==e[i-1].event.pageX&&e[i].event.pageY==e[i-1].event.pageY&&e[i].timestamp-e[i-1].timestamp<200&&e[i].timestamp-e[i-1].timestamp>50?t.extend(e[i].event,{type:"zoom.doubleTap"}):"tap"==e[i].name?t.extend(e[i].event,{type:"zoom.tap"}):void 0},_prepareZoom:function(){var o,e=0,i=this.data().zoom,n=1/this.zoom("value"),r=i.opts.flipbook,a=r.turn("direction"),u=r.data(),h=r.offset(),l=this.offset(),p={height:r.height()},d=r.turn("view");"double"==r.turn("display")&&r.data().opts.autoCenter?d[0]?d[1]?(p.width=r.width(),o=s(h.left-l.left,h.top-l.top)):(p.width=r.width()/2,e="ltr"==a?0:p.width,o=s("ltr"==a?h.left-l.left:h.left-l.left+p.width,h.top-l.top)):(p.width=r.width()/2,e="ltr"==a?p.width:0,o=s("ltr"==a?h.left-l.left+p.width:h.left-l.left,h.top-l.top)):(p.width=r.width(),o=s(h.left-l.left,h.top-l.top)),i.zoomer||(i.zoomer=t("<div />",{class:"zoomer",css:{overflow:"hidden",position:"absolute",zIndex:"1000000"}}).mousedown(function(){return!1}).appendTo(this)),i.zoomer.css({top:o.y,left:o.x,width:p.width,height:p.height});var c=d.join(",");if(c!=i.zoomerView){i.zoomerView=c,i.zoomer.find("*").remove();for(var f=0;f<d.length;f++)if(d[f]){var m=u.pageObjs[d[f]].offset(),v=t(u.pageObjs[d[f]]);v.clone().transform("").css({width:v.width()*n,height:v.height()*n,position:"absolute",display:"",top:(m.top-h.top)*n,left:(m.left-h.left-e)*n}).appendTo(i.zoomer)}}return{pos:o,size:p}},value:function(){var t=this.data().zoom;return t.opts.flipbook.turn("zoom")},zoomIn:function(o){var e,r=this,a=this.data().zoom,u=a.opts.flipbook,l=a.opts.max(),p=(u.offset(),this.offset());if(a.zoomIn)return this;u.turn("stop");var d=t.Event("zoom.change");if(this.trigger(d,[l]),d.isDefaultPrevented())return this;var c=h._prepareZoom.call(this),f=c.pos,m=s(c.size.width/2,c.size.height/2),v=t.cssPrefix(),g=t.cssTransitionEnd(),x=u.data().opts.autoCenter;a.scale=l,u.data().noCenter=!0,e="undefined"!=typeof o?"x"in o&&"y"in o?s(o.x-f.x,o.y-f.y):t.isTouch?s(o.originalEvent.touches[0].pageX-f.x-p.left,o.originalEvent.touches[0].pageY-f.y-p.top):s(o.pageX-f.x-p.left,o.pageY-f.y-p.top):s(m.x,m.y),(e.x<0||e.y<0||e.x>c.width||e.y>c.height)&&(e.x=m.x,e.y=m.y);var z=s((e.x-m.x)*l+m.x,(e.y-m.y)*l+m.y),y=s(c.size.width*l>this.width()?e.x-z.x:0,c.size.height*l>this.height()?e.y-z.y:0),w=s(Math.abs(c.size.width*l-this.width()),Math.abs(c.size.height*l-this.height())),b=s(Math.min(0,c.size.width*l-this.width()),Math.min(0,c.size.height*l-this.height())),_=s(m.x*l-m.x-f.x-y.x,m.y*l-m.y-f.y-y.y);_.y>w.y?y.y=_.y-w.y+y.y:_.y<b.y&&(y.y=_.y-b.y+y.y),_.x>w.x?y.x=_.x-w.x+y.x:_.x<b.x&&(y.x=_.x-b.x+y.x),_=s(m.x*l-m.x-f.x-y.x,m.y*l-m.y-f.y-y.y);var T={};T[v+"transition"]=v+"transform "+a.opts.easeFunction+" "+a.opts.duration+"ms";var E=function(){r.trigger("zoom.zoomIn"),a.zoomIn=!0,a.flipPosition=s(u.css("left"),u.css("top")),u.turn("zoom",l);var o=u.offset();a.axis=s(o.left-p.left,o.top-p.top),x&&"double"==u.turn("display")&&("ltr"==u.turn("direction")&&!u.turn("view")[0]||"rtl"==u.turn("direction")&&!u.turn("view")[1])&&(a.axis.x=a.axis.x+u.width()/2),r.zoom("scroll",_),r.bind(t.mouseEvents.down,h._eMouseDown),r.bind(t.mouseEvents.move,h._eMouseMove),t(document).bind(t.mouseEvents.up,a.mouseupEvent),r.bind("mousewheel",h._eMouseWheel),setTimeout(function(){a.zoomer.hide(),a.zoomer.remove(),a.zoomer=null,a.zoomerView=null},50)};return a.zoomer.css(T).show(),g?a.zoomer.bind(g,function(){t(this).unbind(g),E()}):setTimeout(E,a.opts.duration),a.zoomer.transform(i(y.x,y.y,!0)+n(l,!0)),this},zoomOut:function(o){var e,r=this,a=this.data().zoom,u=a.opts.flipbook,l=1,p=l/a.scale,d=t.cssPrefix(),c=t.cssTransitionEnd(),f=this.offset();if(o="undefined"!=typeof o?o:a.opts.duration,a.zoomIn){var m=t.Event("zoom.change");if(this.trigger(m,[l]),m.isDefaultPrevented())return this;a.zoomIn=!1,a.scale=l,u.data().noCenter=!1,r.unbind(t.mouseEvents.down,h._eMouseDown),r.unbind(t.mouseEvents.move,h._eMouseMove),t(document).unbind(t.mouseEvents.up,a.mouseupEvent),r.unbind("mousewheel",h._eMouseWheel);var v={};v[d+"transition"]=d+"transform "+a.opts.easeFunction+" "+o+"ms",u.css(v);var g,x=t("<div />",{css:{position:"relative",top:a.flipPosition.y,left:a.flipPosition.x,width:u.width()*p,height:u.height()*p,background:"blue"}}).appendTo(u.parent());g=s(x.offset().left-f.left,x.offset().top-f.top),x.remove();var z=u.data().opts.autoCenter;z&&"double"==u.turn("display")&&(u.turn("view")[0]?u.turn("view")[1]||(g.x="ltr"==u.turn("direction")?g.x+x.width()/4:g.x-x.width()/4):g.x="ltr"==u.turn("direction")?g.x-x.width()/4:g.x+x.width()/4);var y=u.offset();e=s(-u.width()/2-y.left+x.width()/2+g.x+f.left,-u.height()/2-y.top+x.height()/2+g.y+f.top);var w=function(){u[0].style.removeProperty?(u[0].style.removeProperty(d+"transition"),u.transform(u.turn("options").acceleration?i(0,0,!0):"").turn("zoom",1),u[0].style.removeProperty("margin"),u.css({position:"relative",top:a.flipPosition.y,left:a.flipPosition.x})):u.transform("none").turn("zoom",1).css({margin:"",top:a.flipPosition.y,left:a.flipPosition.x,position:"relative"}),z&&u.turn("center"),r.trigger("zoom.zoomOut")};return 0===o?w():c?(u.bind(c,function(){t(this).unbind(c),w()}),u.transform(i(e.x,e.y,!0)+n(p,!0))):(setTimeout(w,o),u.transform(i(e.x,e.y,!0)+n(p,!0))),this}},flipbookWidth:function(){var t=this.data().zoom,o=t.opts.flipbook,e=o.turn("view");return"double"!=o.turn("display")||e[0]&&e[1]?o.width():o.width()/2},scroll:function(o,e,n){var r=this.data().zoom,u=r.opts.flipbook,h=this.zoom("flipbookWidth"),l=t.cssPrefix();if(a){var p={};n?p[l+"transition"]=l+"transform 200ms":p[l+"transition"]="none",u.css(p),u.transform(i(-r.axis.x-o.x,-r.axis.y-o.y,!0))}else u.css({top:-r.axis.y-o.y,left:-r.axis.x-o.x});if(!e){var d,c=s(Math.min(0,(h-this.width())/2),Math.min(0,(u.height()-this.height())/2)),f=s(h>this.width()?h-this.width():(h-this.width())/2,u.height()>this.height()?u.height()-this.height():(u.height()-this.height())/2);o.y<c.y?(o.y=c.y,d=!0):o.y>f.y&&(o.y=f.y,d=!0),o.x<c.x?(o.x=c.x,d=!0):o.x>f.x&&(o.x=f.x,d=!0),d&&this.zoom("scroll",o,!0,!0)}r.scrollPos=s(o.x,o.y)},resize:function(){var t=this.data().zoom,o=t.opts.flipbook;if(this.zoom("value")>1){var e=o.offset(),i=this.offset();t.axis=s(e.left-i.left+(t.axis.x+t.scrollPos.x),e.top-i.top+(t.axis.y+t.scrollPos.y)),"double"!=o.turn("display")||"ltr"!=o.turn("direction")||o.turn("view")[0]||(t.axis.x=t.axis.x+o.width()/2),this.zoom("scroll",t.scrollPos)}},_eZoom:function(){for(var t=this.data().zoom,o=t.opts.flipbook,e=o.turn("view"),i=0;i<e.length;i++)e[i]&&this.trigger("zoom.resize",[t.scale,e[i],o.data().pageObjs[e[i]]])},_eStart:function(t,o){1!=this.zoom("value")&&t.preventDefault()},_eTurning:function(t,o,e){var i=this,n=this.zoom("value"),s=this.data().zoom,r=s.opts.flipbook;if(s.page=r.turn("page"),1!=n){for(var a=0;a<e.length;a++)e[a]&&this.trigger("zoom.resize",[n,e[a],r.data().pageObjs[e[a]]]);setTimeout(function(){i.zoom("resize")},0)}},_eTurned:function(t,o){if(1!=this.zoom("value")){var e=this.data().zoom,i=e.opts.flipbook;o>e.page?this.zoom("scroll",s(0,e.scrollPos.y),!1,!0):o<e.page&&this.zoom("scroll",s(i.width(),e.scrollPos.y),!1,!0)}},_ePressed:function(){var o=t(this).data().zoom;o.draggingCorner=!0},_eReleased:function(){var o=t(this).data().zoom;setTimeout(function(){o.draggingCorner=!1},1)},_eMouseDown:function(o){var e=t(this).data().zoom;return e.draggingCur=t.isTouch?s(o.originalEvent.touches[0].pageX,o.originalEvent.touches[0].pageY):s(o.pageX,o.pageY),!1},_eMouseMove:function(o){var e=t(this).data().zoom;if(e.draggingCur){e.dragging=!0;var i=t.isTouch?s(o.originalEvent.touches[0].pageX,o.originalEvent.touches[0].pageY):s(o.pageX,o.pageY),n=s(i.x-e.draggingCur.x,i.y-e.draggingCur.y);return t(this).zoom("scroll",s(e.scrollPos.x-n.x,e.scrollPos.y-n.y),!0),e.draggingCur=i,!1}},_eMouseUp:function(o){var e=t(this).data().zoom;e.dragging&&t(this).zoom("scroll",e.scrollPos),e.draggingCur=null,setTimeout(function(){e.dragging=!1},1)},_eMouseWheel:function(o,e,i,n){var r=t(this).data().zoom,a=s(r.scrollPos.x+10*i,r.scrollPos.y-10*n);t(this).zoom("scroll",a,!1,!0)},_eTouchStart:function(o,e){var i=t(this).data().zoom,n=(i.opts.flipbook,s(o.originalEvent.touches[0].pageX,o.originalEvent.touches[0].pageY));i.touch={},i.touch.initial=n,i.touch.last=n,i.touch.timestamp=(new Date).getTime(),i.touch.speed=s(0,0)},_eTouchMove:function(o){var e=t(this).data().zoom,i=t(this).zoom("value"),n=e.opts.flipbook,r=(new Date).getTime(),a=s(o.originalEvent.touches[0].pageX,o.originalEvent.touches[0].pageY);e.touch&&1==i&&!n.data().mouseAction&&(e.touch.motion=s(a.x-e.touch.last.x,a.y-e.touch.last.y),e.touch.speed.x=0===e.touch.speed.x?e.touch.motion.x/(r-e.touch.timestamp):(e.touch.speed.x+e.touch.motion.x/(r-e.touch.timestamp))/2,e.touch.last=a,e.touch.timestamp=r)},_eTouchEnd:function(o){var e=t(this).data().zoom;if(e.touch&&1==t(this).zoom("value")){var i=Math.abs(e.touch.initial.y-e.touch.last.y);i<50&&(e.touch.speed.x<-1||e.touch.last.x-e.touch.initial.x<-100)?this.trigger("zoom.swipeLeft"):i<50&&(e.touch.speed.x>1||e.touch.last.x-e.touch.initial.x>100)&&this.trigger("zoom.swipeRight")}},_eDestroying:function(){var o=this,e=this.data().zoom,i=e.opts.flipbook,n=["tap","doubleTap","resize","zoomIn","zoomOut","swipeLeft","swipeRight"];this.zoom("zoomOut",0),t.each(n,function(t,e){o.unbind("zoom."+e)});for(var s in e.flipbookEvents)Object.prototype.hasOwnProperty.call(e.flipbookEvents,s)&&i.unbind(s,e.flipbookEvents[s]);i.unbind("touchstart",e.eventTouchStart).unbind("touchmove",e.eventTouchMove).unbind("touchend",e.eventTouchEnd),this.unbind("touchstart",h._tap).unbind("click",h._tap),e=null,this.data().zoom=null}};t.extend(t.fn,{zoom:function(){var o=arguments;if(o[0]&&"object"!=typeof o[0]){if(h[o[0]])return h[o[0]].apply(t(this[0]),Array.prototype.slice.call(o,1));throw e(o[0]+" is not a method")}return h.init.apply(t(this[0]),o)}})}(jQuery);